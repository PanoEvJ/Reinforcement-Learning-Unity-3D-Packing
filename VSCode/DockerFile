FROM nvidia/cuda:10.0-base-ubuntu18.04

# Install required packages
RUN apt-get update && \
    apt-get install -y wget git unzip && \
    apt-get install -y python3 python3-pip && \
    apt-get install -y xvfb && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

# Install Unity
RUN wget -q https://beta.unity3d.com/download/0825c3f30c9a/UnitySetup-2018.2.0f2 && \
    chmod +x UnitySetup-2018.2.0f2 && \
    echo y | ./UnitySetup-2018.2.0f2 --unattended --install-location /opt/Unity-2018.2.0f2 && \
    rm UnitySetup-2018.2.0f2

# Install ML-Agents
RUN git clone https://github.com/Unity-Technologies/ml-agents.git && \
    cd ml-agents && \
    git checkout 0.15.1 && \
    pip3 install -e .

# Set up display
ENV DISPLAY=:1

# Set working directory
WORKDIR /app

# Copy your Unity build to the container
COPY YourUnityBuild /app

# Start Xvfb and run Unity
CMD Xvfb :1 -screen 0 1024x768x16 & \
    cd /app && \
    /opt/Unity-2018.2.0f2/Editor/Unity \
    -batchmode \
    -nographics \
    -logFile $(pwd)/unity.log \
    -quit && \
    mlagents-learn config/ppo/YourConfig.yaml --env=YourBuild.app --run-id=YourRunID
